# ✅ خطة عمل (TODO) - نظام التخطيط والمشاريع (10)

---

## ⚠️ تذكير هام - القواعد الصارمة ⚠️

**قبل كتابة أي سطر كود، اقرأ والتزم بملف `docs/12_القواعد_الصارمة.md`.**

> **القاعدة الذهبية:** لا شاشة بدون Backend، لا بيانات وهمية، CRUD كامل.

---

## المرحلة 1: البنية التحتية والإعداد (Sprint 1)

- **الهدف:** تجهيز بيئة العمل، إعداد قاعدة البيانات، وبناء الوحدات الأساسية.
- **الالتزام:** كل خطوة يجب أن تكون متصلة ومختبرة.

- [ ] **1.1 إعداد Prisma Schema:**
  - [ ] تحويل جميع جداول SQL من `docs/10_نظام_التخطيط_والمشاريع.md` إلى Prisma Schema.
  - [ ] إضافة البادئة `proj_` لجميع الجداول (مثال: `proj_projects`).
  - [ ] التأكد من العلاقات (relations) بين الجداول.
  - [ ] **القاعدة الصارمة:** استخدام `uuid()` للمفاتيح الأساسية.

- [ ] **1.2 تشغيل Migration:**
  - [ ] `npx prisma migrate dev --name init-projects-schema`
  - [ ] التحقق من إنشاء الجداول في قاعدة بيانات PostgreSQL.

- [ ] **1.3 بناء وحدة المشاريع (Core Projects Module):**
  - [ ] إنشاء `ProjectsModule`, `ProjectsService`, `ProjectsController`.
  - [ ] بناء API لإنشاء مشروع جديد (`POST /api/v1/projects`).
  - [ ] بناء API لعرض قائمة المشاريع (`GET /api/v1/projects`).
  - [ ] **القاعدة الصارمة:** اختبار الـ APIs عبر Postman/Swagger والتأكد من حفظ البيانات في قاعدة البيانات.

- [ ] **1.4 بناء شاشة قائمة المشاريع:**
  - [ ] إنشاء `ProjectsListComponent` في Angular.
  - [ ] ربط الشاشة بـ API `GET /api/v1/projects`.
  - [ ] عرض المشاريع في جدول PrimeNG (`p-table`).
  - [ ] **القاعدة الصارمة:** لا بيانات وهمية، يجب أن تعرض الشاشة البيانات من قاعدة البيانات مباشرة.

- [ ] **1.5 بناء شاشة إنشاء مشروع:**
  - [ ] إنشاء `ProjectCreateComponent` مع الحقول الأساسية.
  - [ ] ربط زر الحفظ بـ API `POST /api/v1/projects`.
  - [ ] بعد الحفظ، يجب إعادة التوجيه لقائمة المشاريع ورؤية المشروع الجديد.
  - [ ] **القاعدة الصارمة:** التحقق من أن المشروع الجديد تم إنشاؤه فعلاً في قاعدة البيانات.

---

## المرحلة 2: تجزئة العمل والميزانية (Sprint 2)

- **الهدف:** بناء الوحدات الخاصة بتجزئة العمل (WBS) والميزانية.
- **الالتزام:** كل شاشة يجب أن تكون تفاعلية ومتصلة بالـ Backend.

- [ ] **2.1 بناء وحدة تجزئة العمل (WBS):**
  - [ ] بناء APIs لإدارة الخطط (`phases`) وحزم العمل (`work_packages`).
  - [ ] بناء شاشة تجزئة العمل (WBS) التفاعلية.
  - [ ] **القاعدة الصارمة:** يجب أن يتمكن المستخدم من إضافة وتعديل وحذف الخطط وحزم العمل مباشرة من الشاشة، ورؤية التغييرات فوراً.

- [ ] **2.2 بناء وحدة الميزانية:**
  - [ ] بناء APIs لإدارة ميزانية المشروع (`project_budgets`) والمصروفات (`project_expenses`).
  - [ ] بناء شاشة الميزانية لعرض الميزانية المعتمدة والمصروف الفعلي.
  - [ ] **القاعدة الصارمة:** كل مصروف يتم تسجيله يجب أن يُنشئ قيد محاسبي في النظام الأم (عبر API).

---

## المرحلة 3: مخطط جانت والرقابة الزمنية (Sprint 3)

- **الهدف:** بناء مخطط جانت تفاعلي وحساب المسار الحرج.
- **الالتزام:** يجب أن يكون المخطط ديناميكياً ويعكس البيانات الحقيقية.

- [ ] **3.1 بناء مخطط جانت:**
  - [ ] بناء API `GET /api/v1/projects/:id/gantt` لجلب بيانات المخطط.
  - [ ] استخدام مكتبة `dhtmlx-gantt` أو مشابهة في Angular.
  - [ ] ربط المخطط بالـ API.
  - [ ] **القاعدة الصارمة:** أي تغيير في تواريخ المهام يجب أن يتم حفظه في قاعدة البيانات عبر API.

- [ ] **3.2 حساب المسار الحرج:**
  - [ ] بناء منطق في الـ Backend لحساب المسار الحرج (Critical Path).
  - [ ] بناء API `GET /api/v1/projects/:id/critical-path`.
  - [ ] تلوين المهام الحرجة في مخطط جانت.

---

## المرحلة 4: إدارة المقاولين والمستخلصات (Sprint 4)

- **الهدف:** بناء الوحدات الخاصة بإدارة المقاولين والمستخلصات.
- **الالتزام:** كل مستخلص يجب أن يمر بدورة موافقات كاملة.

- [ ] **4.1 بناء وحدة المقاولين:**
  - [ ] بناء APIs لإدارة المقاولين والعقود.
  - [ ] بناء شاشة لإضافة وتعديل المقاولين.

- [ ] **4.2 بناء وحدة المستخلصات:**
  - [ ] بناء APIs لإدارة المستخلصات (`contractor_invoices`).
  - [ ] بناء شاشة لتقديم المستخلصات من قبل المقاولين.
  - [ ] بناء دورة موافقات (Workflow) للمستخلصات.
  - [ ] **القاعدة الصارمة:** لا يمكن صرف مستخلص إلا بعد موافقة مدير المشروع.

---

## المرحلة 5: معالج إغلاق المشروع (Sprint 5)

- **الهدف:** بناء معالج إغلاق المشروع لضمان إغلاق سليم.
- **الالتزام:** يجب أن يقوم المعالج بتنفيذ جميع الخطوات بشكل آلي.

- [ ] **5.1 بناء معالج الإغلاق (Wizard):**
  - [ ] بناء واجهة مستخدم متعددة الخطوات (Wizard).
  - [ ] بناء APIs لكل خطوة (التحقق، تصفية العهد، رسملة الأصول).
  - [ ] **القاعدة الصارمة:** يجب أن يقوم المعالج بإنشاء قيود محاسبية لرسملة الأصول وإغلاق المشروع في النظام الأم.

---

## ⚠️ تذكير نهائي ⚠️

**كل مهمة في هذه القائمة يجب أن تتبع تسلسل البناء الإلزامي:**

1. **Prisma Schema**
2. **Migration**
3. **NestJS (Service + Controller)**
4. **Postman/Swagger Test**
5. **Angular Component**
6. **ربط الشاشة بالـ API**
7. **اختبار CRUD كامل ببيانات حقيقية**

**أي مهمة لا تتبع هذا التسلسل تعتبر غير مكتملة.**
