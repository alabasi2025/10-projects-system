# ✅ خطة عمل (TODO) - نظام التخطيط والمشاريع (10)

---

## ⚠️ تذكير هام - القواعد الصارمة ⚠️

**قبل كتابة أي سطر كود، اقرأ والتزم بملف `docs/12_القواعد_الصارمة.md`.**

> **القاعدة الذهبية:** لا شاشة بدون Backend، لا بيانات وهمية، CRUD كامل.

---

## المرحلة 1: البنية التحتية والإعداد (Sprint 1) ✅ مكتمل

- **الهدف:** تجهيز بيئة العمل، إعداد قاعدة البيانات، وبناء الوحدات الأساسية.
- **الالتزام:** كل خطوة يجب أن تكون متصلة ومختبرة.

- [x] **1.1 إعداد Prisma Schema:**
  - [x] تحويل جميع جداول SQL من `docs/10_نظام_التخطيط_والمشاريع.md` إلى Prisma Schema.
  - [x] إضافة البادئة `proj_` لجميع الجداول (مثال: `proj_projects`).
  - [x] التأكد من العلاقات (relations) بين الجداول.
  - [x] **القاعدة الصارمة:** استخدام `uuid()` للمفاتيح الأساسية.

- [x] **1.2 تشغيل Migration:**
  - [x] `npx prisma migrate dev --name init-projects-schema`
  - [x] التحقق من إنشاء الجداول في قاعدة بيانات PostgreSQL (16 جدول).

- [x] **1.3 بناء وحدة المشاريع (Core Projects Module):**
  - [x] إنشاء `ProjectsModule`, `ProjectsService`, `ProjectsController`.
  - [x] بناء API لإنشاء مشروع جديد (`POST /api/v1/projects`).
  - [x] بناء API لعرض قائمة المشاريع (`GET /api/v1/projects`).
  - [x] بناء API لتحديث مشروع (`PUT /api/v1/projects/:id`).
  - [x] بناء API لحذف مشروع (`DELETE /api/v1/projects/:id`).
  - [x] بناء API للإحصائيات (`GET /api/v1/projects/statistics`).
  - [x] **القاعدة الصارمة:** اختبار الـ APIs عبر Swagger والتأكد من حفظ البيانات في قاعدة البيانات.

- [x] **1.4 بناء شاشة قائمة المشاريع:**
  - [x] إنشاء `ProjectListComponent` في Angular.
  - [x] ربط الشاشة بـ API `GET /api/v1/projects`.
  - [x] عرض المشاريع في بطاقات مع إحصائيات.
  - [x] إضافة فلاتر للبحث والحالة والنوع.
  - [x] **القاعدة الصارمة:** لا بيانات وهمية، الشاشة تعرض البيانات من قاعدة البيانات مباشرة.

- [x] **1.5 بناء شاشة إنشاء مشروع:**
  - [x] إنشاء `ProjectFormComponent` مع جميع الحقول.
  - [x] ربط زر الحفظ بـ API `POST /api/v1/projects`.
  - [x] بعد الحفظ، إعادة التوجيه لقائمة المشاريع ورؤية المشروع الجديد.
  - [x] **القاعدة الصارمة:** التحقق من أن المشروع الجديد تم إنشاؤه فعلاً في قاعدة البيانات.

---

## المرحلة 2: تجزئة العمل والميزانية (Sprint 2) ✅ مكتمل

- **الهدف:** بناء الوحدات الخاصة بتجزئة العمل (WBS) والميزانية.
- **الالتزام:** كل شاشة يجب أن تكون تفاعلية ومتصلة بالـ Backend.

- [x] **2.1 بناء وحدة تجزئة العمل (WBS):**
  - [x] بناء APIs لإدارة الخطط (`phases`) وحزم العمل (`work_packages`).
  - [x] بناء شاشة تجزئة العمل (WBS) التفاعلية.
  - [x] **القاعدة الصارمة:** يجب أن يتمكن المستخدم من إضافة وتعديل وحذف الخطط وحزم العمل مباشرة من الشاشة، ورؤية التغييرات فوراً.

- [x] **2.2 بناء وحدة الميزانية:**
  - [x] بناء APIs لإدارة ميزانية المشروع (`project_budgets`) والمصروفات (`project_expenses`).
  - [x] بناء شاشة الميزانية لعرض الميزانية المعتمدة والمصروف الفعلي.
  - [ ] **القاعدة الصارمة:** كل مصروف يتم تسجيله يجب أن يُنشئ قيد محاسبي في النظام الأم (عبر API).

---

## المرحلة 3: مخطط جانت والرقابة الزمنية (Sprint 3) ✅ مكتمل

- **الهدف:** بناء مخطط جانت تفاعلي وحساب المسار الحرج.
- **الالتزام:** يجب أن يكون المخطط ديناميكياً ويعكس البيانات الحقيقية.

- [x] **3.1 بناء مخطط جانت:**
  - [x] بناء API `GET /api/v1/projects/:id/gantt` لجلب بيانات المخطط.
  - [x] بناء مكون `GanttChartComponent` في Angular مع عرض تفاعلي.
  - [x] ربط المخطط بالـ API.
  - [x] عرض المشروع والمراحل وحزم العمل في المخطط.
  - [x] إضافة خيارات التكبير (يوم/أسبوع/شهر).
  - [x] **القاعدة الصارمة:** أي تغيير في تواريخ المهام يجب أن يتم حفظه في قاعدة البيانات عبر API.

- [x] **3.2 حساب المسار الحرج:**
  - [x] بناء منطق في الـ Backend لحساب المسار الحرج (Critical Path).
  - [x] بناء API `GET /api/v1/projects/:id/gantt/critical-path`.
  - [x] إضافة زر لإظهار/إخفاء المسار الحرج في المخطط.
  - [x] عرض إحصائيات المخطط (مدة المشروع، المهام الحرجة، تاريخ الانتهاء).

- [x] **3.3 APIs إضافية:**
  - [x] بناء API `PUT /api/v1/projects/:id/gantt/tasks/:taskId/dates` لتحديث تواريخ المهام.
  - [x] بناء API `PUT /api/v1/projects/:id/gantt/tasks/:taskId/progress` لتحديث نسبة التقدم.

---

## المرحلة 4: إدارة المقاولين والمستخلصات (Sprint 4)

- **الهدف:** بناء الوحدات الخاصة بإدارة المقاولين والمستخلصات.
- **الالتزام:** كل مستخلص يجب أن يمر بدورة موافقات كاملة.

- [ ] **4.1 بناء وحدة المقاولين:**
  - [ ] بناء APIs لإدارة المقاولين والعقود.
  - [ ] بناء شاشة لإضافة وتعديل المقاولين.

- [ ] **4.2 بناء وحدة المستخلصات:**
  - [ ] بناء APIs لإدارة المستخلصات (`contractor_invoices`).
  - [ ] بناء شاشة لتقديم المستخلصات من قبل المقاولين.
  - [ ] بناء دورة موافقات (Workflow) للمستخلصات.
  - [ ] **القاعدة الصارمة:** لا يمكن صرف مستخلص إلا بعد موافقة مدير المشروع.

---

## المرحلة 5: التقارير ولوحة المعلومات (Sprint 5)

- **الهدف:** بناء لوحة معلومات شاملة وتقارير تفاعلية.
- **الالتزام:** كل تقرير يجب أن يعكس البيانات الحقيقية من قاعدة البيانات.

- [ ] **5.1 بناء لوحة المعلومات:**
  - [ ] بناء API `GET /api/v1/dashboard` لجلب الإحصائيات الشاملة.
  - [ ] بناء شاشة Dashboard مع رسوم بيانية.

- [ ] **5.2 بناء التقارير:**
  - [ ] تقرير حالة المشاريع.
  - [ ] تقرير الميزانية والمصروفات.
  - [ ] تقرير الأداء الزمني.
  - [ ] **القاعدة الصارمة:** كل تقرير يجب أن يكون قابلاً للتصدير إلى PDF/Excel.

---

## المرحلة 6: التكامل مع النظام الأم (Sprint 6)

- **الهدف:** ربط النظام بالنظام الأم (ERP) لتبادل البيانات.

- [ ] **6.1 التكامل المحاسبي:**
  - [ ] ربط المصروفات بنظام المحاسبة (إنشاء قيود محاسبية).
  - [ ] ربط المستخلصات بنظام الموردين.

- [ ] **6.2 التكامل مع الموارد البشرية:**
  - [ ] جلب بيانات الموظفين من نظام HR.
  - [ ] ربط فريق المشروع بالموظفين.

---

## ملاحظات عامة

- **الاختبار:** كل API يجب اختباره عبر Swagger قبل بناء الشاشة.
- **التوثيق:** تحديث هذا الملف بعد إكمال كل مهمة.
- **الالتزام بالقواعد:** مراجعة `docs/12_القواعد_الصارمة.md` باستمرار.

---

## سجل التحديثات

| التاريخ | المرحلة | الوصف |
|---------|---------|-------|
| 2025-12-18 | المرحلة 1 | إكمال البنية التحتية وإعداد المشاريع |
| 2025-12-18 | المرحلة 2 | إكمال تجزئة العمل والميزانية |
| 2025-12-18 | المرحلة 3 | إكمال مخطط جانت والرقابة الزمنية |
