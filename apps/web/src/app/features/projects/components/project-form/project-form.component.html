<div class="form-container">
  <!-- ุฑุฃุณ ุงูุตูุญุฉ -->
  <div class="page-header">
    <div class="header-content">
      <a routerLink="/projects" class="back-link">
        <span>โ</span> ุงูุนูุฏุฉ ูููุงุฆูุฉ
      </a>
      <h1>{{ pageTitle() }}</h1>
    </div>
  </div>

  <!-- ุญุงูุฉ ุงูุชุญููู -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงููุดุฑูุน...</p>
    </div>
  }

  <!-- ุฑุณุงูุฉ ุงูุฎุทุฃ -->
  @if (error()) {
    <div class="error-banner">
      <span class="error-icon">โ๏ธ</span>
      <span>{{ error() }}</span>
      <button class="close-btn" (click)="error.set(null)">ร</button>
    </div>
  }

  <!-- ุงููููุฐุฌ -->
  @if (!loading()) {
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="project-form">
      <!-- ุงููุณู ุงูุฃูู: ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ -->
      <div class="form-section">
        <h2 class="section-title">ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="projectNumber">ุฑูู ุงููุดุฑูุน <span class="required">*</span></label>
            <div class="input-with-action">
              <input
                type="text"
                id="projectNumber"
                formControlName="projectNumber"
                placeholder="ูุซุงู: PROJ-2025-001"
                [class.invalid]="isFieldInvalid('projectNumber')"
              />
              <button
                type="button"
                class="generate-btn"
                (click)="generateProjectNumber()"
                title="ุชูููุฏ ุฑูู ุชููุงุฆู"
              >
                ๐
              </button>
            </div>
            @if (isFieldInvalid('projectNumber')) {
              <span class="error-text">{{ getFieldError('projectNumber') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="projectType">ููุน ุงููุดุฑูุน <span class="required">*</span></label>
            <select
              id="projectType"
              formControlName="projectType"
              [class.invalid]="isFieldInvalid('projectType')"
            >
              @for (option of typeOptions; track option.value) {
                <option [value]="option.value">{{ option.label }}</option>
              }
            </select>
            @if (isFieldInvalid('projectType')) {
              <span class="error-text">{{ getFieldError('projectType') }}</span>
            }
          </div>
        </div>

        <div class="form-group full-width">
          <label for="name">ุงุณู ุงููุดุฑูุน <span class="required">*</span></label>
          <input
            type="text"
            id="name"
            formControlName="name"
            placeholder="ุฃุฏุฎู ุงุณู ุงููุดุฑูุน"
            [class.invalid]="isFieldInvalid('name')"
          />
          @if (isFieldInvalid('name')) {
            <span class="error-text">{{ getFieldError('name') }}</span>
          }
        </div>

        <div class="form-group full-width">
          <label for="description">ูุตู ุงููุดุฑูุน</label>
          <textarea
            id="description"
            formControlName="description"
            placeholder="ุฃุฏุฎู ูุตูุงู ุชูุตูููุงู ูููุดุฑูุน"
            rows="3"
          ></textarea>
        </div>
      </div>

      <!-- ุงููุณู ุงูุซุงูู: ุงูุฃูุฏุงู ูุงููุทุงู -->
      <div class="form-section">
        <h2 class="section-title">ุงูุฃูุฏุงู ูุงููุทุงู</h2>

        <div class="form-group full-width">
          <label for="objectives">ุฃูุฏุงู ุงููุดุฑูุน</label>
          <textarea
            id="objectives"
            formControlName="objectives"
            placeholder="ุญุฏุฏ ุงูุฃูุฏุงู ุงูุฑุฆูุณูุฉ ูููุดุฑูุน"
            rows="3"
          ></textarea>
        </div>

        <div class="form-group full-width">
          <label for="scope">ูุทุงู ุงูุนูู</label>
          <textarea
            id="scope"
            formControlName="scope"
            placeholder="ุญุฏุฏ ูุทุงู ุงูุนูู ูุงูููุงู ุงููุทููุจุฉ"
            rows="3"
          ></textarea>
        </div>

        <div class="form-group full-width">
          <label for="deliverables">ุงููุฎุฑุฌุงุช ุงููุชููุนุฉ</label>
          <textarea
            id="deliverables"
            formControlName="deliverables"
            placeholder="ุญุฏุฏ ุงููุฎุฑุฌุงุช ูุงูุชุณูููุงุช ุงููุชููุนุฉ"
            rows="3"
          ></textarea>
        </div>
      </div>

      <!-- ุงููุณู ุงูุซุงูุซ: ุงูููุฒุงููุฉ -->
      <div class="form-section">
        <h2 class="section-title">ุงูููุฒุงููุฉ</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="estimatedBudget">ุงูููุฒุงููุฉ ุงูุชูุฏูุฑูุฉ <span class="required">*</span></label>
            <input
              type="number"
              id="estimatedBudget"
              formControlName="estimatedBudget"
              placeholder="0"
              min="0"
              [class.invalid]="isFieldInvalid('estimatedBudget')"
            />
            @if (isFieldInvalid('estimatedBudget')) {
              <span class="error-text">{{ getFieldError('estimatedBudget') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="approvedBudget">ุงูููุฒุงููุฉ ุงููุนุชูุฏุฉ</label>
            <input
              type="number"
              id="approvedBudget"
              formControlName="approvedBudget"
              placeholder="0"
              min="0"
            />
          </div>

          <div class="form-group">
            <label for="currency">ุงูุนููุฉ</label>
            <select id="currency" formControlName="currency">
              <option value="SAR">ุฑูุงู ุณุนูุฏู (SAR)</option>
              <option value="USD">ุฏููุงุฑ ุฃูุฑููู (USD)</option>
              <option value="EUR">ููุฑู (EUR)</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ุงููุณู ุงูุฑุงุจุน: ุงูุฌุฏูู ุงูุฒููู -->
      <div class="form-section">
        <h2 class="section-title">ุงูุฌุฏูู ุงูุฒููู</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="plannedStartDate">ุชุงุฑูุฎ ุงูุจุฏุก ุงููุฎุทุท <span class="required">*</span></label>
            <input
              type="date"
              id="plannedStartDate"
              formControlName="plannedStartDate"
              [class.invalid]="isFieldInvalid('plannedStartDate')"
            />
            @if (isFieldInvalid('plannedStartDate')) {
              <span class="error-text">{{ getFieldError('plannedStartDate') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="plannedEndDate">ุชุงุฑูุฎ ุงูุงูุชูุงุก ุงููุฎุทุท <span class="required">*</span></label>
            <input
              type="date"
              id="plannedEndDate"
              formControlName="plannedEndDate"
              [class.invalid]="isFieldInvalid('plannedEndDate')"
            />
            @if (isFieldInvalid('plannedEndDate')) {
              <span class="error-text">{{ getFieldError('plannedEndDate') }}</span>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="actualStartDate">ุชุงุฑูุฎ ุงูุจุฏุก ุงููุนูู</label>
            <input
              type="date"
              id="actualStartDate"
              formControlName="actualStartDate"
            />
          </div>

          <div class="form-group">
            <label for="actualEndDate">ุชุงุฑูุฎ ุงูุงูุชูุงุก ุงููุนูู</label>
            <input
              type="date"
              id="actualEndDate"
              formControlName="actualEndDate"
            />
          </div>

          <div class="form-group">
            <label for="durationDays">ุงููุฏุฉ (ุฃูุงู)</label>
            <input
              type="number"
              id="durationDays"
              formControlName="durationDays"
              placeholder="ููุญุณุจ ุชููุงุฆูุงู"
              min="1"
            />
          </div>
        </div>
      </div>

      <!-- ุงููุณู ุงูุฎุงูุณ: ุงูุญุงูุฉ ูุงูุชูุฏู -->
      <div class="form-section">
        <h2 class="section-title">ุงูุญุงูุฉ ูุงูุชูุฏู</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="status">ุญุงูุฉ ุงููุดุฑูุน</label>
            <select id="status" formControlName="status">
              @for (option of statusOptions; track option.value) {
                <option [value]="option.value">{{ option.label }}</option>
              }
            </select>
          </div>

          <div class="form-group">
            <label for="progressPercent">ูุณุจุฉ ุงูุชูุฏู (%)</label>
            <input
              type="number"
              id="progressPercent"
              formControlName="progressPercent"
              placeholder="0"
              min="0"
              max="100"
              [class.invalid]="isFieldInvalid('progressPercent')"
            />
            @if (isFieldInvalid('progressPercent')) {
              <span class="error-text">{{ getFieldError('progressPercent') }}</span>
            }
          </div>
        </div>
      </div>

      <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCancel()"
          [disabled]="submitting()"
        >
          ุฅูุบุงุก
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="submitting()"
        >
          @if (submitting()) {
            <span class="spinner-small"></span>
            ุฌุงุฑู ุงูุญูุธ...
          } @else {
            {{ isEditMode() ? 'ุญูุธ ุงูุชุบููุฑุงุช' : 'ุฅูุดุงุก ุงููุดุฑูุน' }}
          }
        </button>
      </div>
    </form>
  }
</div>
