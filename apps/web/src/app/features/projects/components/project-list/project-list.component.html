<div class="projects-container">
  <!-- ุฑุฃุณ ุงูุตูุญุฉ -->
  <div class="page-header">
    <div class="header-content">
      <h1>ุฅุฏุงุฑุฉ ุงููุดุงุฑูุน</h1>
      <p>ุนุฑุถ ูุฅุฏุงุฑุฉ ุฌููุน ุงููุดุงุฑูุน ูู ุงููุธุงู</p>
    </div>
    <a routerLink="/projects/new" class="btn btn-primary">
      <span class="icon">+</span>
      ุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ
    </a>
  </div>

  <!-- ุจุทุงูุงุช ุงูุฅุญุตุงุฆูุงุช -->
  @if (statistics()) {
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon total">๐</div>
        <div class="stat-content">
          <span class="stat-value">{{ statistics()!.totalProjects }}</span>
          <span class="stat-label">ุฅุฌูุงูู ุงููุดุงุฑูุน</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon draft">๐</div>
        <div class="stat-content">
          <span class="stat-value">{{ statistics()!.byStatus.draft }}</span>
          <span class="stat-label">ูุณูุฏุฉ</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon progress">๐</div>
        <div class="stat-content">
          <span class="stat-value">{{ statistics()!.byStatus.inProgress }}</span>
          <span class="stat-label">ููุฏ ุงูุชูููุฐ</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon completed">โ</div>
        <div class="stat-content">
          <span class="stat-value">{{ statistics()!.byStatus.completed }}</span>
          <span class="stat-label">ููุชูู</span>
        </div>
      </div>
      <div class="stat-card wide">
        <div class="stat-icon budget">๐ฐ</div>
        <div class="stat-content">
          <span class="stat-value">{{ formatCurrency(statistics()!.financial.totalBudget) }}</span>
          <span class="stat-label">ุฅุฌูุงูู ุงูููุฒุงููุฉ</span>
        </div>
      </div>
    </div>
  }

  <!-- ุดุฑูุท ุงูุจุญุซ ูุงูููุงุชุฑ -->
  <div class="filters-bar">
    <div class="search-box">
      <input
        type="text"
        placeholder="ุงูุจุญุซ ูู ุงููุดุงุฑูุน..."
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)"
        (keyup.enter)="onSearch()"
      />
      <button class="search-btn" (click)="onSearch()">๐</button>
    </div>

    <div class="filters">
      <select
        [ngModel]="selectedStatus()"
        (ngModelChange)="selectedStatus.set($event); onFilterChange()"
      >
        <option value="">ุฌููุน ุงูุญุงูุงุช</option>
        @for (option of statusOptions; track option.value) {
          <option [value]="option.value">{{ option.label }}</option>
        }
      </select>

      <select
        [ngModel]="selectedType()"
        (ngModelChange)="selectedType.set($event); onFilterChange()"
      >
        <option value="">ุฌููุน ุงูุฃููุงุน</option>
        @for (option of typeOptions; track option.value) {
          <option [value]="option.value">{{ option.label }}</option>
        }
      </select>
    </div>
  </div>

  <!-- ุญุงูุฉ ุงูุชุญููู -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>ุฌุงุฑู ุชุญููู ุงููุดุงุฑูุน...</p>
    </div>
  }

  <!-- ุฑุณุงูุฉ ุงูุฎุทุฃ -->
  @if (error()) {
    <div class="error-state">
      <span class="error-icon">โ๏ธ</span>
      <p>{{ error() }}</p>
      <button class="btn btn-secondary" (click)="loadProjects()">ุฅุนุงุฏุฉ ุงููุญุงููุฉ</button>
    </div>
  }

  <!-- ูุงุฆูุฉ ุงููุดุงุฑูุน -->
  @if (!loading() && !error()) {
    @if (projects().length === 0) {
      <div class="empty-state">
        <span class="empty-icon">๐</span>
        <h3>ูุง ุชูุฌุฏ ูุดุงุฑูุน</h3>
        <p>ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ูุดุงุฑูุน. ุงุจุฏุฃ ุจุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ.</p>
        <a routerLink="/projects/new" class="btn btn-primary">ุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ</a>
      </div>
    } @else {
      <div class="projects-grid">
        @for (project of projects(); track project.id) {
          <div class="project-card">
            <div class="card-header">
              <span class="project-number">{{ project.projectNumber }}</span>
              <span
                class="status-badge"
                [style.background-color]="getStatusColor(project.status)"
              >
                {{ statusLabels[project.status] }}
              </span>
            </div>

            <div class="card-body">
              <h3 class="project-name">{{ project.name }}</h3>
              <p class="project-description">{{ project.description || 'ูุง ููุฌุฏ ูุตู' }}</p>

              <div class="project-meta">
                <div class="meta-item">
                  <span class="meta-label">ุงูููุน:</span>
                  <span class="meta-value">{{ typeLabels[project.projectType] }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">ุงูููุฒุงููุฉ:</span>
                  <span class="meta-value">{{ formatCurrency(project.estimatedBudget, project.currency) }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">ุชุงุฑูุฎ ุงูุจุฏุก:</span>
                  <span class="meta-value">{{ formatDate(project.plannedStartDate) }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">ุชุงุฑูุฎ ุงูุงูุชูุงุก:</span>
                  <span class="meta-value">{{ formatDate(project.plannedEndDate) }}</span>
                </div>
              </div>

              <div class="progress-section">
                <div class="progress-header">
                  <span>ุงูุชูุฏู</span>
                  <span>{{ getProgressText(project.progressPercent) }}</span>
                </div>
                <div class="progress-bar">
                  <div
                    class="progress-fill"
                    [style.width]="project.progressPercent + '%'"
                    [style.background-color]="getStatusColor(project.status)"
                  ></div>
                </div>
              </div>
            </div>

            <div class="card-footer">
              <a [routerLink]="['/projects', project.id]" class="btn btn-sm btn-secondary">
                ุนุฑุถ ุงูุชูุงุตูู
              </a>
              <a [routerLink]="['/projects', project.id, 'edit']" class="btn btn-sm btn-outline">
                ุชุนุฏูู
              </a>
              <button class="btn btn-sm btn-danger" (click)="deleteProject(project)">
                ุญุฐู
              </button>
            </div>
          </div>
        }
      </div>

      <!-- ุงูุชุฑููู -->
      @if (totalPages() > 1) {
        <div class="pagination">
          <button
            class="page-btn"
            [disabled]="currentPage() === 1"
            (click)="goToPage(currentPage() - 1)"
          >
            ุงูุณุงุจู
          </button>

          <div class="page-info">
            ุตูุญุฉ {{ currentPage() }} ูู {{ totalPages() }}
            <span class="total-items">({{ totalItems() }} ูุดุฑูุน)</span>
          </div>

          <button
            class="page-btn"
            [disabled]="currentPage() === totalPages()"
            (click)="goToPage(currentPage() + 1)"
          >
            ุงูุชุงูู
          </button>
        </div>
      }
    }
  }
</div>
